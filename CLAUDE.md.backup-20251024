# CLAUDE.md - security-phishing-detector

# Memory System: ~/.claude/memories/

## Project Overview
**Machine learning-based phishing email detector** using scikit-learn, XGBoost, and feature extraction.

## Key Metrics
- **Status:** Active Development
- **Language:** Python **3.9.6** (REQUIRED - ML models trained with this version)
- **Started:** August 13, 2025
- **Tech Stack:** FastAPI, scikit-learn, XGBoost, LightGBM

---

## ✅ Python Environment (Updated October 22, 2025)

**CRITICAL:** This project requires **Python 3.9.6** for ML model compatibility.

### Required Setup

**Python Version:** 3.9.6 (System Python)
- **Location:** `/usr/bin/python3`
- **Reason:** ML models trained with scikit-learn 1.6.1 on Python 3.9.6
- **Virtual Environment:** Use `/usr/bin/python3 -m venv venv`

### Setup Commands

```bash
cd ~/Projects/Security-Tools/security-phishing-detector

# Create venv with SYSTEM Python 3.9.6
/usr/bin/python3 -m venv venv

# Activate
source venv/bin/activate

# Verify Python version
python --version  # MUST show: Python 3.9.6

# Install dependencies
pip install --upgrade pip
pip install -r requirements.txt
```

### Verification

```bash
source venv/bin/activate
python --version  # Should show: Python 3.9.6
which python      # Should point to venv/bin/python
```

**If Python 3.14 is used by mistake:** ML models may not load correctly due to scikit-learn version incompatibility.

### Global Python Status (Reference)

**System resolved Python corruption issue on October 22, 2025:**
- Python 3.14.0 now available at `/Library/Frameworks/Python.framework/Versions/3.14/bin/python3`
- Python 3.9.6 still available at `/usr/bin/python3`
- This project uses Python 3.9.6 intentionally

**See global CLAUDE.md (~/.claude/CLAUDE.md) for full Python environment details.**

---

## Dependencies (Python 3.9.6 Compatible)

**Core Framework:**
- `fastapi==0.118.0`
- `uvicorn==0.37.0`
- `pydantic==2.11.1`

**Machine Learning (EXACT versions required):**
- `scikit-learn==1.6.1` ⚠️ CRITICAL - Models trained with this version
- `xgboost==2.1.4`
- `lightgbm==4.6.0`
- `imbalanced-learn==0.12.4`
- `pandas>=2.0.0,<3.0.0`
- `numpy>=1.24.0,<3.0.0`
- `joblib==1.5.2`

**Feature Extraction:**
- `validators==0.35.0`
- `tldextract==5.3.0`
- `python-Levenshtein==0.27.1`

---

## Working Commands

### Start API Server
```bash
cd ~/Projects/Security-Tools/security-phishing-detector
source venv/bin/activate
python3 -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### Run Tests
```bash
source venv/bin/activate
pytest tests/ -v
```

### Train Models (if needed)
```bash
source venv/bin/activate
python3 train_models.py
```

---

## Project-Specific Rules

### ML Model Compatibility
- **DO NOT upgrade scikit-learn** - Models are serialized with version 1.6.1
- **DO NOT use Python 3.10+** - May cause model loading issues
- Always use Python 3.9.6 for this project

### Security Considerations
- Models detect phishing based on URL structure, email patterns, headers
- Not a replacement for human judgment
- Should be used as one layer of defense

### Performance Requirements
- API response time: <100ms per email
- Batch processing: 1000 emails/minute
- Model accuracy: >95% (as of last training)

---

## Known Issues

### ⚠️ Python Version Sensitivity
- Models were trained with Python 3.9.6 and scikit-learn 1.6.1
- Using different versions may cause unpredictable behavior
- Always verify Python version before development

### requirements.txt Comment ERROR (Fixed)
- ~~requirements.txt previously claimed "Python 3.9.6 REQUIRED"~~
- This is **correct** for this project
- Do NOT upgrade to Python 3.14 for this project

---

## Model Performance

**Current Metrics (Last Updated: October 2025):**
- Accuracy: 96.2%
- Precision: 94.8%
- Recall: 97.1%
- F1-Score: 95.9%

**Training Data:**
- 10,000+ labeled phishing emails
- 10,000+ legitimate emails
- Balanced with SMOTE for minority class

---

*Project-specific configuration for security-phishing-detector*
*Python 3.9.6 REQUIRED - Do not upgrade*